id: nz.co.mega.MEGAsync
sdk: org.kde.Sdk
runtime: org.kde.Platform
runtime-version: "5.12"
finish-args:
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  - --share=network
  - --socket=pulseaudio
  - --talk-name=org.freedesktop.Notifications
  - --talk-name=org.kde.StatusNotifierWatcher
  - --own-name=org.kde.StatusNotifierItem-2-1
  - --filesystem=host
command: megasync
rename-icon: mega
copy-icon: true
rename-desktop-file: megasync.desktop
cleanup:
  - "*.a"
  - "*.la"
  - /include
  - /lib/pkgconfig
  - /lib/cmake
  - /share/doc
modules:

  - name: MEGAsync
    buildsystem: qmake
    subdir: src
    build-options:
      env:
        DESKTOP_DESTDIR: /app
    config-opts:
      - QMAKE_LIBDIR=/app/lib
    post-install:
      - install -D MEGASync/megasync -t /app/bin/
    sources:
      - type: git
        url: "https://github.com/meganz/MEGAsync.git"
        tag: v4.0.2.0_Linux
      - type: shell
        dest: src/MEGASync/mega
        commands:
          - ./autogen.sh
          - ./configure --prefix=/app
      - type: shell
        dest: src
        commands:
          - lrelease MEGASync/MEGASync.pro
    modules:

      - name: cryptopp
        no-autogen: true
        make-args:
          - shared
        make-install-args:
          - PREFIX=/app
          - LIBDIR=/app/lib
        sources:
          - type: archive
            url: "https://github.com/weidai11/cryptopp/archive/CRYPTOPP_8_1_0.tar.gz"
            sha256: 8a4e4773a39b0c07d7cea1b8be7a3f7a9d126bd3ac9a9f072f82d3a53a474a87
        cleanup:
          - /bin
          - /share

      - name: c-ares
        buildsystem: cmake-ninja
        sources:
          - type: archive
            url: "http://c-ares.haxx.se/download/c-ares-1.15.0.tar.gz"
            sha256: 6cdb97871f2930530c97deb7cf5c8fa4be5a0b02c7cea6e7c7667672a39d6852
        cleanup:
          - /bin

      - name: freeimage
        no-autogen: true
        make-install-args:
          - DESTDIR=/app
          - INCDIR=/app/include
          - INSTALLDIR=/app/lib
        sources:
          - type: archive
            url: "http://downloads.sourceforge.net/freeimage/FreeImage3180.zip"
            sha256: f41379682f9ada94ea7b34fe86bf9ee00935a3147be41b6569c9605a53e438fd
          - type: patch
            path: patches/freeimage-makefile-install.patch

      - name: libsodium
        sources:
          - type: archive
            url: "https://download.libsodium.org/libsodium/releases/libsodium-1.0.16.tar.gz"
            sha256: eeadc7e1e1bcef09680fb4837d448fbdf57224978f865ac1c16745868fbd0533

      - name: libmediainfo
        buildsystem: cmake-ninja
        subdir: Project/CMake
        builddir: true
        sources:
          - type: archive
            url: "http://mediaarea.net/download/source/libmediainfo/18.12/libmediainfo_18.12.tar.xz"
            sha256: 976f3d42c092359769f9ed95168a2c9e661edd3afe63b8de9b4e8a2123836e4f
        modules:

          - name: libzen
            buildsystem: cmake-ninja
            subdir: Project/CMake
            builddir: true
            sources:
              - type: archive
                url: "https://mediaarea.net/download/source/libzen/0.4.37/libzen_0.4.37.tar.gz"
                sha256: 8c4323bd3f1a286a565b634cb00c9877922296679f49ac55b05f7c6e56d77c43

      - name: libuv
        sources:
          - type: archive
            url: "https://dist.libuv.org/dist/v1.27.0/libuv-v1.27.0.tar.gz"
            sha256: 8d887047a3670606f6b87e5acdee586caccc6157331096c9c8e102804488cdca

      - name: LibRaw
        sources:
          - type: archive
            url: "https://www.libraw.org/data/LibRaw-0.19.2.tar.gz"
            sha256: 400d47969292291d297873a06fb0535ccce70728117463927ddd9452aa849644
        cleanup:
          - /bin
